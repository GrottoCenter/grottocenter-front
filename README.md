# grottocenter-front

Manage Grottocenter front packages and main app

This project use:
- [Yarn 2 'Berry'](https://github.com/yarnpkg/berry) & [yarn workspaces](https://classic.yarnpkg.com/en/docs/workspaces/)
  
- [Lerna](https://github.com/lerna/lerna)



### List of all available packages:
- [**web-app**](/packages/web-app/README.md)

  Main web app
    
- **configurations**
  
  Shared quality and formatting rules
  
  - [eslint-config](/packages/eslint-config/README.md)
  - [eslint-config-typescript](/external/eslint-config/README.md)
  - [ts-config](/external/ts-config/README.md)
    
- [**Storybook**](/packages/storybook/README.md)

## Getting Started

- Use node >= 16
- Install [Yarn](https://yarnpkg.com/getting-started/install)
- `yarn` at the top-level of the repo, it will automatically install all dependencies and link local packages

## Scripts
- `start:app` start main Grottocenter app **using the production api**
- `storybook` start storybook
- `test`: run unit `test` commands on all packages
- `build`: builds all packages with `build` script

## CI

Github Actions is running 2 tasks on push and pull requests on `develop` :
 - Lint
 - Azure Static Web Apps deploy

## Release and publish

###Â WIP

## Production deployment (Azure)

The grottocenter front web application (under `packages/web-app`) is deployed Microsoft Azure Static Web Apps.

Azure staticwebapps is serving the static files generated by the `yarn build` task which are located under `packages/web-app/build`.

### Check the static app locally
You can test the static app generated by `yarn build` before deploying it to Azure locally
```
npm install -g serve
cd packages/web-app
serve -s build
```
### Static Web app Creation
using the following `az` command line (need to be run only 1 time) :
```
az staticwebapp create \
-n grottocenter-front \
-g Grottocenter \
-s https://github.com/GrottoCenter/grottocenter-front \
-l WestEurope \
-b develop \
--app-location . \
--api-location /api \
--output-location packages/web-app/build \
--token GITHUB_TOKEN_WITH_WORKFLOW_ACCESS \
--debug
```
| DANGER ZONE |
| --- |
You can delete the static web app with :
```
az staticwebapp delete \
    --name grottocenter-front \
    --resource-group Grottocenter
```
### Automated deployment
On every push to the `develop` branch the `Github Actions` workflow to deploy the latest code will run automatically.

| Later we should switch to the `master` branch instead of the `develop` branch to deploy less often and a more stable code |
| --- |

## Project organization

### Git-rules

#### Hooks

To prevent a bad commit, we use the Git hooks [husky](https://github.com/typicode/husky)

#### Commit type

[Commitlint rules](https://www.conventionalcommits.org/en/v1.0.0/) define in [commitlint config](commitlint.config.js)


## Specific dependencies or fixed version, known errors
Some dependencies are not updated or needed due to incompatibility or issues.

Added dependencies:
  
  *Used on `web-app` package*
- `eslint-config-react-app`
  Related to `yarn 2`: [issue](https://github.com/facebook/create-react-app/issues/10463)
  

Current problem:

error related bad dependencies:
https://yarnpkg.com/getting-started/migration
.yarnrc.yml
